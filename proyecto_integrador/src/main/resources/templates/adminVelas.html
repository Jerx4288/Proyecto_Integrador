<!DOCTYPE html>
<html lang="es">
<head>
    <th:block th:include="layouts/admin :: cabecera_usuario"></th:block>
    <title>Pabluki's Bakery | Perfil Administrador</title>
    <link th:href="@{/css/estilosAdmin.css}" rel="stylesheet">
    <link th:href="@{/css/tablaAdmin.css}" rel="stylesheet">   
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <div class="content">
            <div th:replace="layouts/admin :: datos_usuario"></div>
            <div th:replace="layouts/admin :: barra_usuario"></div>
            <div class="">
                <div class="page">
                    <div id="primeraseccion">
                        <h1>Velas: </h1> 
                        <div class="cambiar_vela">
                            <button ><a th:href="@{/admin/tortas}" class="btn btn-primary">Tortas Clásicas</a></button>
                                <button ><a th:href="@{/admin/tortase}" class="btn btn-primary">Tortas Especiales</a></button>
                                <button ><a th:href="@{/admin/velas}" class="btn btn-primary">Velas</a></button>
                        </div>
                        <button class="btn btn-primary" onclick="toggleSections()">Ver Gráficos</button>
                    </div>
                    <div id="segundaseccion">
                        <button>Generar Reportes de Stock</button>
                        <button>Generar Reportes de Grafico</button>
                    </div>
                    <div id="tercera_seccion" >
                        <table class="styled-table">
                            <thead>
                                <tr>
                                    <th>ID de Vela</th>
                                    <th>Modelo</th>
                                    <th>Precio</th>
                                    <th>Stock</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="item: ${listaVelas}">
                                    <td th:text="${item.id_vela}"></td>
                                    <td th:text="${item.modelo_vela}"></td>
                                    <td th:text="${item.precio_vela}"></td>
                                    <td>
                                        <form th:action="@{/admin/editarVelas/{id}(id=${item.id_vela})}" method="post" id="form_edita_vela">
                                            <input type="number" th:name="stock" th:value="${item.stock_vela}" min="0" required />
                                            <button type="submit" class="btn btn-warning">
                                                <i class="fa-solid fa-pen-to-square"></i> Editar Stock
                                            </button>
                                        </form>                                            
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- Cuarta sección donde se renderiza el gráfico -->
                    <div id="cuarta_seccion" style="display: none; height: auto; z-index: 100;">
                        <div id="grafico">
                            <canvas id="graficoBarras" width="400" height="110"></canvas>
                            <script th:inline="javascript">
                                /* Los datos ya están pasados correctamente como variables JS en lugar de strings. */

                                var labels = JSON.parse(/*[[${labelsVelas}]]*/ "[]");
                                var values = JSON.parse(/*[[${valuesVelas}]]*/ "[]");

                                console.log(labels);  // Verificar que las etiquetas se pasen correctamente
                                console.log(values);  // Verificar que los valores se pasen correctamente

                                if (labels.length > 0 && values.length > 0) {
                                    // Selecciona el contexto del gráfico
                                    var ctx = document.getElementById('graficoBarras').getContext('2d');

                                    // Crear el gráfico
                                    var chart = new Chart(ctx, {
                                        type: 'bar',
                                        data: {
                                            labels: labels,  // Las etiquetas de los meses
                                            datasets: [{
                                                label: 'Stock de Velas',
                                                data: values,  // Los valores de las velas
                                                backgroundColor: '#f8d3dc',
                                                borderColor: '#e85e7c',
                                                borderWidth: 1
                                            }]
                                        },
                                        options: {
                                            responsive: true,
                                            scales: {
                                                x: {
                                                    type: 'category', // Asegúrate de que las etiquetas sean categorías
                                                    ticks: {
                                                        autoSkip: false  // Para mostrar todas las etiquetas sin que se corten
                                                    }
                                                },
                                                y: {
                                                    beginAtZero: true,
                                                    suggestedMax: Math.max(...values) + 5 // Iniciar desde cero
                                                }
                                            },
                                            barThickness: 30, // Ajusta el grosor de las barras
                                            categoryPercentage: 0.8, // Ajuste de las categorías
                                            barPercentage: 0.9  // Ajuste de las barras dentro de las categorías
                                        }
                                    });
                                } else {
                                    console.error("Los datos no están correctos:", labels, values);
                                }
                            </script>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    function toggleSections() {
        var terceraSeccion = document.getElementById('tercera_seccion');
        var cuartaSeccion = document.getElementById('cuarta_seccion');

        if (terceraSeccion.style.display !== 'none') {
            terceraSeccion.style.display = 'none';  
            cuartaSeccion.style.display = 'block';  
        } else {
            terceraSeccion.style.display = 'block';
            cuartaSeccion.style.display = 'none';
        }
    }
</script>
</html>
